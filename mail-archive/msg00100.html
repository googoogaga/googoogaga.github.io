<!-- MHonArc v2.5.2 -->
<!--X-Subject: Re: Goo porting questions -->
<!--X-From-R13: Xbanguna Pnpuenpu <weoNnv.zvg.rqh> -->
<!--X-Date: Sun, 28 Jul 2002 18:34:35 &#45;0400 (EDT) -->
<!--X-Message-Id: uo8sn235vf8.fsf@djundjun.ai.mit.edu -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: ueldpj1tv.fsf@double.co.nz -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<title>Re: Goo porting questions</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00099.html">Date Prev</a>][<a href="msg00101.html">Date Next</a>][<a href="msg00096.html">Thread Prev</a>][<a href="msg00103.html">Thread Next</a>][<a href="index.html#00100">Date Index</a>][<a href="threads.html#00100">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: Goo porting questions</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Chris Double &lt;<A HREF="mailto:chris@DOMAIN.HIDDEN">chris@xxxxxxxxxxxx</A>&gt;</li>
<li><em>Subject</em>: Re: Goo porting questions</li>
<li><em>From</em>: Jonathan Bachrach &lt;<A HREF="mailto:jrb@DOMAIN.HIDDEN">jrb@xxxxxxxxxx</A>&gt;</li>
<li><em>Date</em>: 28 Jul 2002 18:39:39 -0400</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>
Chris Double &lt;chris@double.co.nz&gt; writes:

&gt; I've been working some more on the Win32 MSVC port and I've got a
&gt; couple of questions/comments.
&gt; 
&gt; Currently I'm not using 'inline' functions with MSVC because I get
&gt; linker errors like the following:
&gt; 
&gt; %lock.obj : error LNK2001: unresolved external symbol _allocate
&gt; math.obj : error LNK2001: unresolved external symbol _YPfi2f
&gt; math.obj : error LNK2001: unresolved external symbol _YPfE
&gt; math.obj : error LNK2001: unresolved external symbol _YPfL
&gt; math.obj : error LNK2001: unresolved external symbol _YPfA
&gt; math.obj : error LNK2001: unresolved external symbol _YPf_
&gt; [...snip...]
&gt; 
&gt; This is caused by functions defined in grt.c as inline. In MSVC all
&gt; inline functions must exist in a header file included by the .c file
&gt; that uses them, otherwise they'll not be linked at all as they don't
&gt; 'exist' having been inlined in the module where they live (grt.c).
&gt; 
&gt; What's a good way of working around this? Move the INLINE functions in
&gt; grt.c to a header file? Don't make them inline? 
&gt;
&gt; In the meantime I'm creating a LOCAL_INLINE which is 'inline' for gcc
&gt; and nothing for MSVC and I'll modify the grt.c inline functions to use
&gt; this. The inline functions in grt.h will remain as INLINE. Maybe not a
&gt; good long term solution as it causes a lot of functions that could be
&gt; inline to not be inlined. I'd like to opt for moving them into grt.h
&gt; or another header file perhaps? Thoughts?

this calls for a reorganization of INLINE functions.  all the flo
routines can be moved to grt.h and other ones could either be marked
LOCAL_INLINE or moved to a private header if their not being inlined
adversely performance.

&gt; I could leave inline out completely for MSVC but it makes Goo a bit
&gt; slower.

no this is too heavy handed.  the bigger problem is that some
primitive functions in boot are defined INLINE and do not occur in a
header and it would be a bit more complicated to produce a header file
c file produced.  i do now have a mechanism for doing my own inlining
of ast but this is a bit slower than the c compiler at this stage of
goo's life so i would like to know if this is indeed a problem.

&gt; My other question is what to do about generating makefiles for
&gt; MSVC. Currently I see the makefile is generated by 'generate-makefile'
&gt; in g2c.goo and it uses Gnu makefiles.
&gt; 
&gt; What's a good way of adding support for generating makefiles for
&gt; Microsoft make?  Or for other build systems (I'd like to get support
&gt; going for Symbian operating systems for example which uses their own
&gt; make type system).
&gt; 
&gt; Is it worth adding some sort of c-backend identifier that things like
&gt; generate-makefile can dispatch on? Or does that add too much knowledge
&gt; to the Goo code about the build system? Other ideas?

i would hate to have target specific builds as this compromises our
ability to produce one set of c-files / makefiles per platform.  of
course this depends on a gnu set up on all platforms (which was the
previous assumption).  given that this isn't possible, would it be
possible to either produce all makefiles or perhaps write a program
that can translate a platform independent makefile (say using sexprs)
producing other platform specific makefiles?  i'm open to suggestions
(esp ones that are simple).

jonathan

</pre>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00096" href="msg00096.html">Goo porting questions</a></strong>
<ul><li><em>From:</em> Chris Double</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00099.html">Goo on a cellphone..almost</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00101.html">Re: Goo on a cellphone..almost</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00096.html">Goo porting questions</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00103.html">Re: Goo porting questions</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="index.html#00100"><strong>Date</strong></a></li>
<li><a href="threads.html#00100"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
